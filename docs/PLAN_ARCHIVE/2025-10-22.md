# Plan snapshot — 2025-10-22

This archive contains the plan file as of 2025-10-22 for traceability.

---

```markdown

# Plan for 2025-10-22

Short goal: Align development activities towards reproducible candidate discovery for K4 by
finishing focused tests, validating the tuning harness, and integrating SPY-based crib extraction
into the autopilot flow.

Related documents / breadcrumbs:

- Project overview: `../README_CORE.md`
- K4 strategy: `K4_STRATEGY.md`
- Autopilot details: `AUTOPILOT.md`
- Roadmap: `../ROADMAP.md`

Top priorities (next iteration):

 - [ ] 1) Finish focused unit tests for `kryptos/k4/scoring.py` to cover edge branches and rare code
  paths. Acceptance: scoring tests green and file coverage >= 95%.
 - [ ] 2) Add unit tests for `kryptos/k4/transposition.py` covering early-exit/route edge cases.
  Acceptance: transposition tests green and file coverage >= 90%.
 - [ ] 3) Wire and validate a deterministic tiny tuning sweep (`scripts/tuning/crib_weight_sweep.py`
  is the canonical harness) with small budgets. Acceptance: artifacts written to
  `artifacts/tuning_runs/run_<ts>/` containing `crib_weight_sweep.csv` and per-weight detail files.
 - [ ] 4) Integrate SPY threshold selection into the autopilot runner so `ask_triumverate.py` will
  compute a conservative `SPY_MIN_CONF` from labeled runs if not set. Acceptance: autopilot dry-run
  invokes SPY with computed threshold and `agents/LEARNED.md` updated in full-run mode.
 - [ ] 5) Run full test suite and confirm overall coverage remains high (target >= 92%).
 - [ ] 1) Finish focused unit tests for `src/k4/scoring.py` to cover edge branches and rare code
   paths. Acceptance: scoring tests green and file coverage >= 95%.
 - [ ] 2) Add unit tests for `src/k4/transposition.py` covering early-exit/route edge cases.
   Acceptance: transposition tests green and file coverage >= 90%.
 - [ ] 3) Wire and validate a deterministic tiny tuning sweep (`scripts/tuning/crib_weight_sweep.py`
   is the canonical harness) with small budgets. Acceptance: artifacts written to
   `artifacts/tuning_runs/run_<ts>/` containing `crib_weight_sweep.csv` and per-weight detail files.
 - [ ] 4) Integrate SPY threshold selection into the autopilot runner so `ask_triumverate.py` will
   compute a conservative `SPY_MIN_CONF` from labeled runs if not set. Acceptance: autopilot dry-run
   invokes SPY with computed threshold and `agents/LEARNED.md` updated in full-run mode.
 - [ ] 5) Run full test suite and confirm overall coverage remains high (target >= 92%).

Progress note:

- We made more progress than expected today — core pipeline, scoring extensions, CSV artifacts,
  adaptive gating, and multiple unit tests are already in place and the full test suite runs quickly
  (~3s locally) with total coverage >92%.
- Given that momentum, the remaining items are focused and should be achievable on the timetable
  below.

Timetable (practical schedule)

- Day 0 (now, 0–4 hours): finish scoring tests (in-progress). Acceptance: `src/k4/scoring.py` >95%
  coverage; tests green locally.
- Day 0 (next 2–4 hours): add transposition tests. Acceptance: `src/k4/transposition.py` >90%
  coverage; tests green.
- Day 0–1 (3–6 hours): wire tiny deterministic tuning sweep (4 combos) in
  `scripts/tune_pipeline.py`. Acceptance: `artifacts/tuning_runs/*.csv` with 4 rows and headers.
- Day 0–1 (3–6 hours): validate the deterministic tuning sweep
  (`scripts/tuning/crib_weight_sweep.py`) with a small grid and verify CSV artifacts are produced.
  Acceptance: artifacts exist and per-weight detail files present.
- Day 1 (0.5–1 hour): run full suite + coverage, produce summary, archive today's close-up to
  `PLAN_ARCHIVE/2025-10-22.md`.
- Day 1–3 (1–3 days): iterative tuning and short search loops to refine scoring weights and gating
  heuristics until candidate quality stabilizes. Expect manual review of top candidates after each
  run.
- Day 3–5 (1 day to set up, then continuous): implement long-loop runner/daemon to run sweeps
  automatically and rotate parameter sets; then monitor artifacts and alerts.

Quick success checkpoints

- Short-term: tests green, scoring & transposition files >90–95% coverage, tuning harness writes
  CSVs.
- Mid-term: several short sweeps produce repeatable top candidates that pass manual inspection
  checks (crib hits, wordlist hit-rate).
- Long-term: continuous runner produces stable daily artifacts and a manageable queue of leads for
  manual analysis.

Stretch tasks (if time permits):

- [ ] 5) Add one integration smoke test that executes the pipeline on a short ciphertext and asserts
  artifact files exist and contain expected headers/keys.
- [ ] 6) Remove deprecated autofix stubs after a quick code review (or move them to
  `tools/deprecated/`).

Execution plan and acceptance criteria:

- For scoring tests: aim to add small isolated inputs that trigger chi-square early returns,
  quadgram fallbacks, baseline_stats branches, and letter_entropy edge cases.
- For transposition: create compact fixtures with constrained column ranges and cribs to force the
  transposition code into the missing branches.
- For tuning sweep: run 4 quick parameter combinations and assert CSV produced with 4 rows; sweep
  must complete in < 30s locally.

Notes:

- I'll update the todo list and start with the scoring tests. I expect to complete priorities 1–3
  within today's session.
After finishing, I'll write a short summary and update `PLAN_ARCHIVE` with the day's close-up.
```
